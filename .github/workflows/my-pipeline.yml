name: AVG-nginx-test

on:
  push:
    branches: [ master ]

jobs:
  terraform-plan-test:
    runs-on: ubuntu-latest
    env: 
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

    steps:
 
      ## Install terraform
      - name: add hashicorp key
        run: curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
      - name: add repo
        run: sudo apt-add-repository "deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
      - name: install terraform
        run: sudo apt update && sudo apt install terraform
      - name: Run a one-line script
        run: echo "Install terraform complete!"
    
    ## Clone and test
      - name: clone repo
        uses: actions/checkout@v2
      - run: echo "Repo cloned!"
      - name: init
        run: terraform init
      - name: plan
        run: terraform plan

